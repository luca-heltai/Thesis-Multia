\begin{document}
\subsubsection{Active flagella}
We mimic the formulation in \cite{julicher} with a discretization in weak form and with a spontaneous curvature, instead of the internal force.



\textbf{Formulation of the Energy}
Given a configuration $\mathbf{r}$(s,t) of an active filament, its energy can be expressed by

\[\mathcal{G}(\mathbf{r}) = \int_0^L \left( \frac{B}{2}(\kappa-\alpha)^2 +
  \frac{\Lambda}{2} \mathbf{r}_s^2 \right) \,d s\]

Where $\alpha$ is an \emph{active curvature}, B is an \emph{active
  bending modulus}, $\kappa$ is the \emph{curvature}, $s$ is the
\emph{arclength}, while $\Lambda$ is the \emph{Lagrange multiplier}
associated with the constraint $\mathbf{r}_s^2 = 1$.

For a two dimensional curve parametrized by arclength, we can define
the tangent vector $\mathbf{a} = \mathbf{r}_s$ as $\mathbf{a} = (\cos(\theta), \sin(\theta))$, and
we can define all quantities of interest in terms of $\theta$. For
example, $\mathbf{a}_s = \kappa \mathbf{b}$, $\mathbf{b}_s = -\kappa \mathbf{a}$ and $\kappa = \theta_s$.

Once a function defining \(\theta(s)\) is available, we can reconstruct
the position of the curve as

\[\mathbf{r}(s) = \mathbf{r}_0 + \int_0^s \left(\cos(\theta(s'), \sin(\theta(s') \right)
\,d s'\]

We can model the internal forces generated by the active curvature
$\alpha$ and the active bending modulus B as

\[f_e = -\frac{\partial \mathcal{G}}{\partial \mathbf{r}} = (H \mathbf{b} + N \mathbf{a})_s\]

Where H is the \emph{shear}, while N is the
\emph{tension}. Given 

\[\zeta := -B(\kappa - \alpha) = -B(\theta_s - \alpha)\]

we can write the shear as

\[H := \zeta_s := -\big( B(\kappa - \alpha) \big)_s\]

and the tension as:

\[N := -\zeta\kappa + \Lambda = B(\theta_s-\alpha)\kappa +\Lambda\]

\\\\

\textbf{Resistive force theory}
When immersed in a fluid, if we use \emph{resistive force theory},
then the force applied by fluid on the filament can be modeled as

\[f_f = -( \xi_\perp \mathbf{b}\otimes \mathbf{b} +\xi_\parallel \mathbf{a}\otimes \mathbf{a}) \mathbf{r}_t\]

that is

\[\mathbf{r}_t = -\left( \frac{1}{\xi_\perp}  \mathbf{b}\otimes \mathbf{b} + \frac{1}{\xi_\parallel} \mathbf{a}\otimes \mathbf{a}\right) f_f\]

From equilibrium, we have

\[f_e+f_f = 0\]

that is

\[\mathbf{r}_t = \left( \frac{1}{\xi_\perp}  
\mathbf{b}\otimes \mathbf{b}  + \frac{1}{\xi_\parallel} \mathbf{a}\otimes \mathbf{a}\right) (H\mathbf{b} + N \mathbf{a})_s\]

Exploiting the fact that \(\mathbf{b}_s = - \kappa \mathbf{a}\) and \(\mathbf{a}_s = \kappa \mathbf{b}\), we
arrive at

\[\mathbf{r}_t =  \frac{1}{\xi_\perp} (H_s + \kappa N) \mathbf{b} + \frac{1}{\xi_\parallel}(N_s - \kappa H) \mathbf{a}\]

Writing $\gamma = \frac{\xi_\perp}{\xi_\parallel}$, we obtain:

\[\xi_\perp \mathbf{r}_t =   (H_s + \kappa N) \mathbf{b} + \gamma (N_s - \kappa H) \mathbf{a}\]

\\\\
\textbf{Excluding the Lagrange multiplier}
We know from the reconstruction of the curve that
\(\mathbf{r}_{ts} = \mathbf{r}_{st} = \theta_s \mathbf{b}\),
and we can exploit this to obtain two equations involving only
\(\theta\),
H
and N (here written also in term of $\kappa = \theta_s$):

\[ \xi_\perp \mathbf{r}_{ts}\cdot \mathbf{b} =\xi_\perp \theta_t =   (H_s + \kappa N)_s + \gamma (\kappa N_s - \kappa^2 H)\]

\[\mathbf{R}_{ts}\cdot \mathbf{A} = 0 =  \gamma(N_s - \kappa H)_s - (\kappa H_s + \kappa^2 N) \]

We linearize this system by splitting all nonlinear terms (which are
only nonlinear because they contain \(\kappa\)), and by iterating over
\(\theta\) until convergence, and constructing \(\bar\kappa\) of the
previous iteration. If we introduce three independent variables
\(\theta\), H and N, for any \(\bar\kappa\), we can write
the linear system:

\[\begin{pmatrix}
-(B\theta_s)_s & -H &  \\
%%
%%
\xi_\perp\theta_t & 
- H_{ss} + \gamma \bar \kappa^2H &
- (\bar\kappa N)_s - \gamma\bar\kappa N_s \\
%%
%%
 & 
\bar \kappa H_s +\gamma(\bar \kappa H)_s &
 - \gamma N_{ss} + \bar \kappa^2 N
\end{pmatrix}
%
=
\begin{pmatrix}
-(B\alpha)_s\\
0\\
0
\end{pmatrix}\]

We multiply the three equations by test functions
$(\delta \theta, \delta H, \delta N)$, and we integrate by parts
whenever it is convenient. We adopt the following notation:
\[
(a,b) := \int_0^1 a(s) b(s) \,d s
\]
\[
\langle a,b \rangle := a(s) b(s) \big|^1_0 = a(1)b(1)-a(0)b(0),
\]
and we move all known terms and boundary terms on the right hand side:

\begin{multline}
\begin{pmatrix}
(B\theta_s, \delta \theta_s)  &  -(H,\delta\theta)  & 0 \\
%%
%%
\xi_\perp(\theta_t, \delta H) & 
(H_{s}, \delta H_s) 
+ \gamma (\bar \kappa^2 H, \delta H ) &
 (\bar\kappa N, \delta H_s) 
- \gamma(\bar\kappa N_s, \delta H) \\
%%
%%
0 & 
(\bar \kappa H_s, \delta N) 
-\gamma(\bar \kappa H, \delta N_s) &
%
%
+ \gamma(N_{s},\delta N_s) 
+ (\bar \kappa^2 N, \delta N)
\end{pmatrix}
%
\\
=
\begin{pmatrix}
(B\alpha, \delta \theta_s)& +\langle B(\theta_s-\alpha), \delta \theta\rangle\\
& \langle H_s+\bar\kappa N,\delta H\rangle
\\
&\gamma\langle N_{s}-\bar \kappa H, \delta N \rangle 
\end{pmatrix}
\end{multline}
\\\\
\textbf{Discretization and Matrix form of the weak formulation}
Here we use the usual shorthand notation. If we restrict the functions $\theta$, H and N to live in V_h we can rewrite the system above in matrix form:

\begin{multline}
\label{eq:4}
\xi_\perp \mathbb{M} \theta_t + 
\begin{pmatrix}
\mathbb{A}^B &  - \mathbb{M} & 0 \\
%%
%%
0 & 
  \mathbb{A}
+ \gamma  \mathbb{M}^{\bar \kappa^2} &
  \mathbb{B}^{\bar\kappa T}
- \gamma \mathbb{B}^{\bar\kappa} \\
%%
%%
0 & 
  \mathbb{B}^{\bar\kappa}
- \gamma \mathbb{B}^{\bar\kappa T} 
&
%
%
\gamma  \mathbb{A}
+  \mathbb{M}^{\bar \kappa^2}
\end{pmatrix}
%
\begin{pmatrix}
\theta\phantom{\big|\!\!}\\
H\phantom{\big|\!\!} \\
N\phantom{\big|\!\!}
\end{pmatrix}
=\\
\begin{pmatrix}
 \mathbb{B}^{BT}\alpha & +\langle \mathbb{B}(\theta_s-\alpha), \delta \theta\rangle\\
& \langle H_s+\bar\kappa N,\delta H \rangle
\\
&\gamma\langle N_{s}-\bar \kappa H, \delta N \rangle 
\end{pmatrix}
\end{multline}

\end{document}